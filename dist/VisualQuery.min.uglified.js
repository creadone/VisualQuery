!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.VisualQuery=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports=function(){"use strict";function b(a,b){c.apply(this),this.type="text",this.name=a,this.$=d("input",{type:"text",spellcheck:"false",autoComplete:"off","class":a}).css("width","1px"),"string"==typeof b&&(this.$._.value=b),this.bindEvents()}var c=a("EventEmitter"),d=a("Element"),e=a("./inputResize");return b.prototype=Object.create(c.prototype),b.prototype.lean=function(){return this.$._.value||""},b.prototype.previewValue=function(a){this.$.attr("placeholder",a).trigger("input")},b.prototype.focus=function(a){this.$.focus(a)},b.prototype.changeValue=function(a){a&&(this.$._.value=a),this.$.trigger("input").trigger("blur").trigger("change"),this.emit("nextInput")},b.prototype.bindEvents=function(){var a=this;this.on("rendered",function(){a.$.trigger("input")}),this.$.on("focus",function(){a.emit("focus")}).on("blur",function(){a.emit("blur")}).on("change",function(){a.emit("change")}).on("keydown",function(b){0===this.selectionStart&&0===this.selectionEnd&&(37===b.keyCode||0===this.value.length&&8===b.keyCode)&&(b.preventDefault(),a.emit("prevInput")),this.value.length===this.selectionStart&&this.value.length===this.selectionEnd&&39===b.keyCode&&(b.preventDefault(),a.emit("nextInput"))}).on("input",e)},b.prototype.validate=function(){var a,b=this.$._.value;return"number"!==this.type||(a=b.match(/^\d+$/))?"time"!==this.type||(a=b.match(/^\d{1,2}:\d{2} (?:AM|PM)$/))?!0:"Not a valid time format":"Not a number"},b}()},{"./inputResize":6,Element:7,EventEmitter:8}],2:[function(a,b){b.exports=function(){"use strict";function b(a,b,c){f.apply(this),this.autocomplete=b,this.schema=c,a=a||{},this.name=new g("name",a.name),this.operator=new g("operator",a.operator),this.value=new g("value",a.value),this.$=e("div",{"class":"parameter"}).append(e("span",{"class":"remove",html:"&times;"}).on("click",this.emit.bind(this,"remove")),this.name.$,this.operator.$,this.value.$),this.validateInputs(),this.bindEvents()}function c(a){return function(b){a.previewValue(b)}}function d(a){return function(b){a.changeValue(b)}}var e=a("Element"),f=a("EventEmitter"),g=a("./Input");return b.prototype=Object.create(f.prototype),b.prototype.lean=function(){return{name:this.name.lean(),operator:this.operator.lean(),value:this.value.lean(),invalid:this.invalid}},b.prototype.bindEvents=function(){var a=this;this.on("rendered",function(){a.name.emit("rendered"),a.operator.emit("rendered"),a.value.emit("rendered")}),[this.name,this.operator,this.value].forEach(function(b){b.on("focus",function(){a.emit("focus"),a.$.removeClass("error").addClass("selected")}).on("blur",function(){a.emit("blur"),a.$.removeClass("selected"),a.validateInputs()}).on("change",function(){a.emit("change")})}),this.bindName(),this.bindOperator(),this.bindValue()},b.prototype.bindName=function(){var a=this;this.name.on("nextInput",function(){a.operator.focus(0)}).on("prevInput",function(){a.emit("prevParameter")}).on("focus",function(){a.autocomplete.bindTo(a.name.$,a.schema.names).on("hover",c(a.name)).on("selected",d(a.name))})},b.prototype.bindOperator=function(){var a=this;this.operator.on("nextInput",function(){a.value.focus(0)}).on("prevInput",function(){a.name.focus(-0)}).on("focus",function(){var b=a.schema._[a.name.$._.value];a.autocomplete.bindTo(a.operator.$,b instanceof Object&&b.operators instanceof Object&&b.operators).on("hover",c(a.operator)).on("selected",d(a.operator))})},b.prototype.bindValue=function(){var a=this;this.value.on("nextInput",function(){a.emit("nextParameter")}).on("prevInput",function(){a.operator.focus(-0)}).on("focus",function(){var b=a.schema._[a.name.$._.value];a.autocomplete.bindTo(a.value.$,b instanceof Object&&b.values instanceof Object&&b.values).on("hover",c(a.value)).on("selected",d(a.value)),b instanceof Object&&("string"==typeof b.type&&(a.value.type=b.type),b.valueAttrs instanceof Object&&"string"==typeof b.valueAttrs.placeholder&&a.value.previewValue(b.valueAttrs.placeholder))})},b.prototype.validateInputs=function(){var a=this.name.$._.value,b=this.operator.$._.value,c=this.value.$._.value;if(!(a+b+c).length)return void this.emit("remove");if(!a.length||!b.length||!c.length)return void this.$.addClass("error").attr("title",this.invalid="Incomplete parameter");if(this.schema.strict){if(!this.schema._.hasOwnProperty(a))return void this.$.addClass("error").attr("title",this.invalid="Invalid name");if(-1===this.schema._[a].operators.indexOf(b))return void this.$.addClass("error").attr("title",this.invalid="Invalid operator");if(this.schema._[a].values instanceof Array&&-1===this.schema._[a].values.indexOf(c))return void this.$.addClass("error").attr("title",this.invalid="Invalid value")}var d;return"string"==typeof(d=this.value.validate())?void this.$.addClass("error").attr("title",d):this.invalid=!1},b}()},{"./Input":1,Element:7,EventEmitter:8}],3:[function(a,b){b.exports=function(){"use strict";function b(a,b){var e=this;d.apply(e),Array.apply(e),e.schema={strict:!!b.strict,names:Object.keys(b.schema),_:b.schema},e.$placeholder=c("div",{"class":"placeholder"}).css("pointerEvents","none").text(b.placeholder||""),e.$inputField=c("div",{"class":"parameters"}).append(e.$placeholder).on("mousedown",function(a){if(a.target===e.$inputField._){a.preventDefault();var b=0;e.some(function(c,d){var e=c.$._.getBoundingClientRect(),f=document.body.scrollTop+e.top;return a.pageY<e.top||f<a.pageY&&a.pageY<f+e.height&&e.left>a.pageX?!0:void(b=d+1)}),e.insertAt(b,e.newParameter(),!0)}}),e.autocomplete=new f(e.$inputField),b.defaultQuery.forEach(function(a){a instanceof Object&&e.insert(a)}),e.appendTo(a),setTimeout(function(){e.emit("result",e.serialize())},0)}var c=a("Element"),d=a("EventEmitter"),e=a("./Parameter"),f=a("./autoComplete");return b.prototype=Object.create(d.prototype),["length","splice","indexOf","forEach","map","some"].forEach(function(a){b.prototype[a]=Array.prototype[a]}),b.prototype.serialize=function(){return this.map(function(a){return a.lean()})},b.prototype.newParameter=function(a){var b=this,c=new e(a,b.autocomplete,b.schema);return c.on("focus",function(){b.$inputField.addClass("selected"),b.emit("focus")}).on("blur",function(){b.$inputField.removeClass("selected"),b.emit("blur")}).on("remove",function(){b.remove(c),b.emit("result",b.serialize())}).on("change",function(){b.emit("result",b.serialize())}).on("prevParameter",function(a){(a=b.getPrev(c))?a.value.focus():b.insertAt(0,b.newParameter(),!0)}).on("nextParameter",function(a){(a=b.getNext(c))?a.name.focus(0):b.insert()})},b.prototype.insertAt=function(a,b,c){this.$placeholder.hide(),this[a]?this.$inputField._.insertBefore(b.$._,this[a].$._):this.$inputField.append(b.$),this.splice(a,0,b),c&&b.name.focus()},b.prototype.insert=function(a){this.insertAt(this.length,this.newParameter(a),!a)},b.prototype.removeAt=function(a){var b=this.splice(a,1);1===b.length&&b[0].$.remove(),0===this.length&&this.$placeholder.show()},b.prototype.remove=function(a,b){return-1===(b=this.indexOf(a))?!1:void this.removeAt(b)},b.prototype.getPrev=function(a,b){return-1!==(b=this.indexOf(a))?this[b-1]:void 0},b.prototype.getNext=function(a,b){return-1!==(b=this.indexOf(a))?this[b+1]:void 0},b.prototype.appendTo=function(a){c(a).append(this.$inputField),this.forEach(function(a){a.emit("rendered")})},b}()},{"./Parameter":2,"./autoComplete":5,Element:7,EventEmitter:8}],4:[function(a,b){b.exports=function(b,c){"use strict";var d;if("string"==typeof b?d=document.querySelector(b):("function"==typeof HTMLElement&&b instanceof HTMLElement||b instanceof Object&&1===b.nodeType&&"string"==typeof b.nodeName)&&(d=b),!d)throw new Error("No element is selected");var e=Object.create({appendAutoCompleteTo:null,strict:!1,schema:{},defaultQuery:[],placeholder:""});for(var f in c)e[f]=c[f];var g=a("./Parameters");return new g(d,e)}},{"./Parameters":3}],5:[function(a,b){b.exports=function(){"use strict";function b(a){this.$ul=c("ul",{"class":"autoComplete"}).css("position","absolute").hide(),this.lis=[],this.selectedLi=null,(this.$parent=a).append(this.$ul).on("scroll",this.adjustLocation.bind(this));var b=this;this.onKeydown=function(a){if(38===a.keyCode){var c;b.selectedLi&&b.selectedLi.shown()&&(c=b.selectedLi.prev())&&c.shown()&&(a.preventDefault(),b.selectLi(c))}if(40===a.keyCode)if(b.selectedLi&&b.selectedLi.shown()){var d;(d=b.selectedLi.next())&&d.shown()&&(a.preventDefault(),b.selectLi(d))}else{var e;for(e=0;e<b.lis.length;e++)if(b.lis[e].shown()){a.preventDefault(),b.selectLi(b.lis[e]);break}}13===a.keyCode&&(b.selectedLi&&b.selectedLi.shown()?b.EE.emit("selected",b.selectedLi.text(),b.selectedLi.attr("value")):b.EE.emit("selected"))},this.onInput=function(){for(var a=0,c=0;c<b.lis.length;c++)b.lis[c].text().match(new RegExp(this.value,"i"))?b.lis[c].show():(b.lis[c].hide(),a++);a===b.lis.length?b.$ul.hide():b.$ul.show()},this.hide=function(){b.$ul.hide()}}var c=a("Element");return b.prototype.adjustLocation=function(){var a=this.$parent._.getBoundingClientRect(),b=this.$input._.getBoundingClientRect();if(!(a.left<b.left&&b.left<a.left+a.width))return void this.$ul.hide();this.$ul.show().offset(0,0);var c=this.$ul._.getBoundingClientRect();this.$ul.offset(b.top-c.top+b.height+"px",b.left-c.left+"px")},b.prototype.selectLi=function(a){this.selectedLi&&this.selectedLi.removeClass("selected"),this.selectedLi=c(a).addClass("selected"),this.EE.emit("hover",this.selectedLi.text()),this.adjustLocation()},b.prototype.createLi=function(a,b){var d=this,e=c("li",{text:a}).on("mouseover",function(){d.selectLi(this)}).on("mousedown",function(a){a.preventDefault()}).on("mouseup",function(){d.selectedLi&&d.selectedLi.shown()&&d.EE.emit("selected",d.selectedLi.text(),d.selectedLi.attr("value"))});return b&&e.attr("value",b),e},b.prototype.setList=function(a){if(this.lis.splice(0),a instanceof Array)for(var b in a)this.lis.push(this.createLi(a[b],!(a instanceof Array)&&b));this.$ul.html("").append(this.lis)},b.prototype.bindTo=function(b,c){this.$input&&(this.$input.off("keydown",this.onKeydown).off("input",this.onInput).off("blur",this.hide),this.$input=null,this.EE=null);var d=a("EventEmitter");return this.EE=new d,this.$input=b.on("keydown",this.onKeydown).on("input",this.onInput).on("blur",this.hide),this.setList(c),this.adjustLocation(),this.onInput.apply(b._),this.EE},b}()},{Element:7,EventEmitter:8}],6:[function(a,b){b.exports=function(){"use strict";var a=this.value,b=a||this.attributes.placeholder&&this.attributes.placeholder.value||"",c=document.createElement("span");c.textContent=b,c.style.position="absolute",c.style.width="auto",c.style.visibility="hidden",c.style.whiteSpace="pre";var d=getComputedStyle(this);["fontSize","fontFamily","fontWeight","fontStyle","fontVariant","wordSpacing","letterSpacing","textIndent","textRendering","textTransform"].forEach(function(a){c.style[a]=d[a]}),this.parentNode.appendChild(c),this.style.width=(c.offsetWidth||5)+1+"px",this.parentNode.removeChild(c)}},{}],7:[function(a,b){b.exports=function(){"use strict";function a(a){this._=a}return a.prototype.addClass=function(a){for(var b=a.split(" "),c=0;c<b.length;c++)b[c]&&(this._.classList?this._.classList.add(b[c]):this._.className=b[c]);return this},a.prototype.removeClass=function(a){return this._.classList?this._.classList.remove(a):this._.className=this._.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," "),this},a.prototype.hide=function(){return"none"!==this._.style.display&&(this._.style.display="none"),this},a.prototype.show=function(){return"block"!==this._.style.display&&(this._.style.display="block"),this},a.prototype.shown=function(){return this._===document||"none"!==this._.style.display&&null!==this._.parentNode},a.prototype.on=function(a,b,c){this._events instanceof Object||(this._events={}),c=!!c,a=a.split(" ");for(var d=a.length;d--;){var e=a[d];this._events[e]instanceof Array||(this._events[e]=[]),this._events[e].push(b),this._.addEventListener(e,b,c)}return this},a.prototype.off=function(a,b){this._events instanceof Object||(this._events={}),a=a.split(" ");var c=a.length;if(b instanceof Function)for(;c--;){var d=a[c];if(this._events[d]instanceof Array){var e=this._events[d].indexOf(b);-1!==e&&this._events[d].splice(e,1),this._.removeEventListener(d,b)}}else for(;c--;){var d=a[c];if(this._events[d]instanceof Array)for(var f;f=this._events[d].pop();)this._.removeEventListener(d,f)}return this},a.prototype.one=function(a,b){var c=this;return this.on(a,function d(){c.off(a,d),b.apply(this,[].slice.apply(arguments))})},a.prototype.append=function(b){for(var c=b instanceof Array?b:arguments,d=document.createDocumentFragment(),e=0,f=c.length;f>e;e++)d.appendChild(c[e]instanceof a?c[e]._:c[e]);return this._.appendChild(d),this},a.prototype.replaceWith=function(b){return b=b instanceof a?b._:b,this._.parentNode&&this._.parentNode.replaceChild(b,this._),this._=b,this},a.prototype.text=function(a,b){var c=this.textWrap||this._;return 0===arguments.length?c.textContent:(c.textContent=(b?c.textContent:"")+a,this)},a.prototype.html=function(a,b){return this._.innerHTML=(b?this._.innerHTML:"")+a,this},a.prototype.attr=function(a,b){if("string"!=typeof a)throw new Error("An attribute name is required");return void 0===b?this._.getAttribute(a):(this._.setAttribute(a,b),this)},a.prototype.remove=function(){return this._.parentNode?(this._.parentNode.removeChild(this._),this):void 0},a.prototype.offset=function(a,b){return this._.style.top=a,this._.style.left=b,this},a.prototype.css=function(a,b){if("string"==typeof a){if("string"!=typeof b)return getComputedStyle(this._)[a];this._.style[a]=b}else if(a instanceof Object)for(var c in a)this._.style[c]=a[c];return this},a.prototype.trigger=function(a){var b=new Event(a);return this._.dispatchEvent(b),this},a.prototype.focus=function(a,b){if(this._.focus(),"number"==typeof a){1/a===-1/0&&(a=this._.value.length),"number"!=typeof b&&(b=a);try{this._.setSelectionRange(a,b)}catch(c){}}return this},a.prototype.prev=function(){return this._.previousSibling?new a(this._.previousSibling):void 0},a.prototype.next=function(){return this._.nextSibling?new a(this._.nextSibling):void 0},a.prototype.data=function(a,b){return this._data instanceof Object||(this._data={}),void 0===b?this._data[a]:(this._data[a]=b,this)},function(b,c){if(b instanceof a)return b;var d=new a;if("string"==typeof b){if(d._=document.createElement(b),"object"==typeof c){var e=Object.create(c);"string"==typeof e.textWrap&&(d.textWrap=document.createElement(e.textWrap),d._.appendChild(d.textWrap),e.textWrap=null),void 0!==e.text&&null!==c.text&&(d.text(e.text),e.text=null),"string"==typeof e.html&&(d.html(e.html),e.html=null),"string"==typeof e.class&&(d.addClass(e.class),e.class=null);for(var f in e)e[f]&&d._.setAttribute(f,e[f])}}else d._=b;return d}}()},{}],8:[function(a,b){b.exports=function(){"use strict";function a(a){this._events={},this.async=!!a}return a.prototype.on=function(a,b){this._events instanceof Object||(this._events={});var c;return(c=this._events[a])instanceof Array||(c=this._events[a]=[]),c.push(b),this},a.prototype.off=function(a,b){this._events instanceof Object&&void 0!==a||(this._events={});var c,d;return(c=this._events[a])instanceof Array?(void 0===b?c.splice(0):-1!==(d=c.indexOf(b))&&c.splice(d,1),this):!1},a.prototype.emit=function(a){if(this._events instanceof Object||(this._events={}),!(this._events[a]instanceof Array))return!1;for(var b,c=[].slice.apply(arguments,[1]),d=this._events[a],e=0,f=d.length;f>e;e++)(b=d[e])instanceof Function&&(this.async===!0?setTimeout(function(a,b,c){return function(){b.apply(a,c)}}(this,b,c),0):b.apply(this,c))},a}()},{}]},{},[4])(4)});