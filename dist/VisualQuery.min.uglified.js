!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.VisualQuery=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports=function(){"use strict";function b(a,b){c.apply(this),this.name=a,this.$=d("input",{type:"text",spellcheck:"false",autoComplete:"off","class":a}).css("width","1px"),b&&(this.$._.value=b),this.bindEvents()}var c=a("EventEmitter"),d=a("Element"),e=a("./inputResize");return b.prototype=Object.create(c.prototype),b.prototype.toJSON=function(){return this.$._.value},b.prototype.previewValue=function(a){this.$.attr("placeholder",a).trigger("input")},b.prototype.focus=function(a){this.$._.disabled=!1,"number"==typeof a&&this.$._.setSelectionRange&&(1/a===-1/0&&(a=this.$._.value.length),this.$._.setSelectionRange(a,a)),this.$._.focus()},b.prototype.changeValue=function(a){a&&(this.$._.value=a),this.$.trigger("input").trigger("blur").trigger("change"),this.emit("nextInput")},b.prototype.bindEvents=function(){var a=this;this.on("rendered",function(){a.$.trigger("input")}),this.$.on("focus",function(){a.emit("focus")}).on("blur",function(){a.emit("blur"),a.$._.disabled=!0}).on("change",function(){a.emit("change")}).on("keydown",function(b){0===this.selectionStart&&0===this.selectionEnd&&(37===b.keyCode||0===this.value.length&&8===b.keyCode)&&(b.preventDefault(),a.emit("prevInput")),this.value.length===this.selectionStart&&this.value.length===this.selectionEnd&&39===b.keyCode&&(b.preventDefault(),a.emit("nextInput"))}).on("input",e)},b.prototype.validate=function(){var a=this.$._.value;return 0===a.length?!1:!0},b}()},{"./inputResize":6,Element:7,EventEmitter:8}],2:[function(a,b){b.exports=function(){"use strict";function b(a,b){f.apply(this),this.collection=a,b=b||{},this.name=new h("name",b.name),this.operator=new h("operator",b.operator),this.value=new h("value",b.value),this.$=e("div",{"class":"parameter"}).append(e("span",{"class":"remove",html:"&times;"}).on("click",this.emit.bind(this,"remove")),this.name.$,this.operator.$,this.value.$),this.bindEvents()}function c(a){return function(b){a.previewValue(b)}}function d(a){return function(b){a.changeValue(b)}}var e=a("Element"),f=a("EventEmitter"),g=a("./autoComplete"),h=a("./Input");return b.prototype=Object.create(f.prototype),b.prototype.toJSON=function(){return{name:this.name.toJSON(),operator:this.operator.toJSON(),value:this.value.toJSON()}},b.prototype.bindEvents=function(){var a=this;this.on("rendered",function(){a.name.emit("rendered"),a.operator.emit("rendered"),a.value.emit("rendered")}),[this.name,this.operator,this.value].forEach(function(b){b.on("focus",function(){a.emit("focus"),a.$.removeClass("error").addClass("selected")}).on("blur",function(){a.emit("blur"),a.$.removeClass("selected"),a.validateInputs()}).on("change",function(){a.emit("change")})}),this.bindName(),this.bindOperator(),this.bindValue(),this.$.on("mousedown",function(b){return b.preventDefault(),a.name.validate()?a.operator.validate()?void a.value.focus():a.operator.focus():a.name.focus()})},b.prototype.bindName=function(){var a=this;this.name.on("nextInput",function(){a.operator.focus(0)}).on("prevInput",function(){a.emit("prevParameter")}).on("focus",function(){g(a.name.$,{appendTo:a.collection.$,datalist:a.collection.names}).on("hover",c(a.name)).on("selected",d(a.name))}).on("blur",function(){g(a.name.$)})},b.prototype.bindOperator=function(){var a=this;this.operator.on("nextInput",function(){a.value.focus(0)}).on("prevInput",function(){a.name.focus(-0)}).on("focus",function(){g(a.operator.$,{appendTo:a.collection.$,datalist:a.collection.opts.schema[a.name.$._.value].operators}).on("hover",c(a.operator)).on("selected",d(a.operator))}).on("blur",function(){g(a.operator.$)})},b.prototype.bindValue=function(){var a=this;this.value.on("nextInput",function(){a.emit("nextParameter")}).on("prevInput",function(){a.operator.focus(-0)}).on("focus",function(){"text"===a.value.$._.type&&g(a.value.$,{appendTo:a.collection.$,datalist:a.collection.opts.schema[a.name.$._.value].values}).on("hover",c(a.value)).on("selected",d(a.value))}).on("blur",function(){g(a.value.$)})},b.prototype.validateInputs=function(){var a=this.name.$._.value,b=this.operator.$._.value,c=this.value.$._.value;return(a+b+c).length?a.length&&b.length&&c.length?!0:(this.$.addClass("error"),!1):(this.emit("remove"),!1)},b}()},{"./Input":1,"./autoComplete":5,Element:7,EventEmitter:8}],3:[function(a,b){b.exports=function(){"use strict";function b(a){a.on("focus",function(){g.$.addClass("selected"),g.focusCallback()}).on("blur",function(){g.$.removeClass("selected"),g.blurCallback()}).on("remove",function(){g.remove(a)}).on("change",function(){g.callback()}).on("prevParameter",function(b){(b=g.getPrev(a))?b.value.focus():g.insertAt(0,new d(g),!0)}).on("nextParameter",function(b){(b=g.getNext(a))?b.name.focus(0):g.insertAt(g.parameters.length,new d(g),!0)})}var c=a("Element"),d=a("./Parameter"),e=c("div",{"class":"placeholder"}).css("pointerEvents","none"),f=c("div",{"class":"parameters"}).append(e).on("mousedown",function(a){if(a.target===g.$._){a.preventDefault();var b=0;g.parameters.some(function(c,d){var e=c.$._.getBoundingClientRect(),f=document.body.scrollTop+e.top;return a.pageY<e.top||f<a.pageY&&a.pageY<f+e.height&&e.left>a.pageX?!0:void(b=d+1)}),g.insertAt(b,new d(g),!0)}}),g={};return g.parameters=[],g.$=f,g.init=function(a){this.opts=a,console.log(this.opts),e.text(a.placeholder||""),this.names=Object.keys(a.schema),this.opts.defaultQuery.forEach(function(a,b){g.insertAt(b,new d(g,a))}),g.callback()},g.insertAt=function(a,c,d){e.hide(),this.parameters[a]?f._.insertBefore(c.$._,this.parameters[a].$._):this.$.append(c.$),this.parameters.splice(a,0,c),b(c),d&&c.name.focus()},g.removeAt=function(a){var b=this.parameters.splice(a,1);1===b.length&&b[0].$.remove(),0===this.parameters.length&&e.show(),g.callback()},g.remove=function(a,b){return-1===(b=this.parameters.indexOf(a))?!1:void this.removeAt(b)},g.getPrev=function(a,b){return-1!==(b=this.parameters.indexOf(a))?this.parameters[b-1]:void 0},g.getNext=function(a,b){return-1!==(b=this.parameters.indexOf(a))?this.parameters[b+1]:void 0},g.renderTo=function(a){c(a).append(this.$),this.parameters.forEach(function(a){a.emit("rendered")})},g.callback=function(){g.opts.callback(g.parameters.map(function(a){return a.toJSON()}))},g}()},{"./Parameter":2,Element:7}],4:[function(a,b){b.exports=function(b,c){"use strict";var d;if("string"==typeof b?d=document.querySelector(b):("function"==typeof HTMLElement&&b instanceof HTMLElement||b instanceof Object&&1===b.nodeType&&"string"==typeof b.nodeName)&&(d=b),!d)throw new Error("No element is selected");var e=a("./Parameters"),f=Object.create({appendAutoCompleteTo:null,strict:!1,schema:[],defaultQuery:[],placeholder:"",focusCallback:function(){},blurCallback:function(){},callback:function(){}});for(var g in c)f[g]=c[g];e.init(f),e.renderTo(d)}},{"./Parameters":3}],5:[function(a,b){b.exports=function(){"use strict";function b(){var a=c._.getBoundingClientRect(),b=d._.getBoundingClientRect();if(!(a.left<b.left&&b.left<a.left+a.width))return void g.hide();g.show().offset(0,0);var e=g._.getBoundingClientRect();g.offset(b.top-e.top+b.height+"px",b.left-e.left+"px")}var c,d,e=a("Element"),f=a("EventEmitter"),g=e("ul",{"class":"autoComplete"}).css("position","absolute").hide(),h=function(){function a(a){k&&k.removeClass("selected"),k=e(a).addClass("selected"),i.emit("hover",k.text())}function b(){for(var a=0,b=0;b<j.length;b++)j[b]._.innerText.match(new RegExp(this.value,"i"))?j[b].show():(j[b].hide(),a++);a===j.length?g.hide():g.show()}function c(b){if(38===b.keyCode){var c;k&&k.shown()&&(c=k.prev())&&c.shown()&&(b.preventDefault(),a(c))}if(40===b.keyCode)if(k&&k.shown()){var d;(d=k.next())&&d.shown()&&(b.preventDefault(),a(d))}else{var e;for(e=0;e<j.length;e++)if(j[e].shown()){b.preventDefault(),a(j[e]);break}}13===b.keyCode&&(k&&k.shown()?i.emit("selected",k.text(),k.attr("value")):i.emit("selected"))}function d(b,c){var d=e("li",{text:b}).on("mouseover",function(){a(this)}).on("mousedown",function(a){a.preventDefault()}).on("mouseup",function(){k&&k.shown()&&i.emit("selected",k.text(),k.attr("value"))});return c&&d.attr("value",c),d}var h=null,i=null,j=[],k=null;return{setDatalist:function(a){j.splice(0);for(var b in a)j.push(d(a[b],!(a instanceof Array)&&b));return g.html("").append(j),this},listenTo:function(a){return h&&(k=null,h.off("keydown",c).off("input",b)),h=a,i=new f,h.on("keydown",c).on("input",b),b.apply(h._),i}}}();return function(a,e){if("INPUT"!==a._.tagName||"text"!==a.attr("type"))throw new Error("Autocomplete must be bound to an input-text element");if(!(e instanceof Object))return g.hide(),d.off("scroll",b),void c.off("scroll",b);if(!e.appendTo)throw new Error("The appendTo property is required to render the auto complete");return d=a.on("input",b),(c=e.appendTo).append(g).on("scroll",b),b(),h.setDatalist(e.datalist).listenTo(a)}}()},{Element:7,EventEmitter:8}],6:[function(a,b){b.exports=function(){"use strict";var a=this.value,b=a||this.attributes.placeholder&&this.attributes.placeholder.value||"",c=document.createElement("span");c.textContent=b,c.style.position="absolute",c.style.width="auto",c.style.visibility="hidden",c.style.whiteSpace="pre";var d=getComputedStyle(this);["fontSize","fontFamily","fontWeight","fontStyle","fontVariant","wordSpacing","letterSpacing","textIndent","textRendering","textTransform"].forEach(function(a){c.style[a]=d[a]}),this.parentNode.appendChild(c),this.style.width=(c.offsetWidth||5)+1+"px",this.parentNode.removeChild(c)}},{}],7:[function(a,b){b.exports=function(){"use strict";function a(a){this._=a}return a.prototype.addClass=function(a){for(var b=a.split(" "),c=0;c<b.length;c++)b[c]&&(this._.classList?this._.classList.add(b[c]):this._.className=b[c]);return this},a.prototype.removeClass=function(a){return this._.classList?this._.classList.remove(a):this._.className=this._.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," "),this},a.prototype.hide=function(){return"none"!==this._.style.display&&(this._.style.display="none"),this},a.prototype.show=function(){return"block"!==this._.style.display&&(this._.style.display="block"),this},a.prototype.shown=function(){return"none"!==this._.style.display},a.prototype.on=function(a,b,c){this._events instanceof Object||(this._events={}),c=!!c,a=a.split(" ");for(var d=a.length;d--;){var e=a[d];this._events[e]instanceof Array||(this._events[e]=[]),this._events[e].push(b),this._.addEventListener(e,b,c)}return this},a.prototype.off=function(a,b){this._events instanceof Object||(this._events={}),a=a.split(" ");var c=a.length;if(b instanceof Function)for(;c--;){var d=a[c];if(this._events[d]instanceof Array){var e=this._events[d].indexOf(b);-1!==e&&this._events[d].splice(e,1),this._.removeEventListener(d,b)}}else for(;c--;){var d=a[c];if(this._events[d]instanceof Array)for(var f;f=this._events[d].pop();)this._.removeEventListener(d,f)}return this},a.prototype.one=function(a,b){var c=this;return this.on(a,function d(){c.off(a,d),b.apply(this,[].slice.apply(arguments))})},a.prototype.append=function(b){for(var c=b instanceof Array?b:arguments,d=0,e=c.length;e>d;d++)this._.appendChild(c[d]instanceof a?c[d]._:c[d]);return this},a.prototype.replaceWith=function(b){return b=b instanceof a?b._:b,this._.parentNode&&this._.parentNode.replaceChild(b,this._),this._=b,this},a.prototype.text=function(a,b){var c=this.textWrap||this._;return 0===arguments.length?c.textContent:(c.textContent=(b?c.textContent:"")+a,this)},a.prototype.html=function(a,b){return this._.innerHTML=(b?this._.innerHTML:"")+a,this},a.prototype.attr=function(a,b){if("string"!=typeof a)throw new Error("An attribute name is required");return void 0===b?this._.getAttribute(a):(this._.setAttribute(a,b),this)},a.prototype.remove=function(){return this._.parentNode?(this._.parentNode.removeChild(this._),this):void 0},a.prototype.offset=function(a,b){return this._.style.top=a,this._.style.left=b,this},a.prototype.css=function(a,b){if("string"==typeof a){if("string"!=typeof b)return getComputedStyle(this._)[a];this._.style[a]=b}else if(a instanceof Object)for(var c in a)this._.style[c]=a[c];return this},a.prototype.trigger=function(a){var b=new Event(a);return this._.dispatchEvent(b),this},a.prototype.prev=function(){return this._.previousSibling?new a(this._.previousSibling):void 0},a.prototype.next=function(){return this._.nextSibling?new a(this._.nextSibling):void 0},a.prototype.data=function(a,b){return this._data instanceof Object||(this._data={}),void 0===b?this._data[a]:(this._data[a]=b,this)},function(b,c){if(b instanceof a)return b;var d=new a;if("string"==typeof b){if(d._=document.createElement(b),"object"==typeof c){var e=Object.create(c);"string"==typeof e.textWrap&&(d.textWrap=document.createElement(e.textWrap),d._.appendChild(d.textWrap),e.textWrap=null),void 0!==e.text&&null!==c.text&&(d.text(e.text),e.text=null),"string"==typeof e.html&&(d.html(e.html),e.html=null),"string"==typeof e.class&&(d.addClass(e.class),e.class=null);for(var f in e)e[f]&&d._.setAttribute(f,e[f])}}else d._=b;return d}}()},{}],8:[function(b,c,d){(function(e){!function(b){"object"==typeof d&&"undefined"!=typeof c?c.exports=b():"function"==typeof a&&a.amd?a([],b):("undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:this).EventEmitter=b()}(function(){return function a(c,d,e){function f(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof b&&b;if(!i&&j)return j(h,!0);if(g)return g(h,!0);throw j=Error("Cannot find module '"+h+"'"),j.code="MODULE_NOT_FOUND",j}j=d[h]={exports:{}},c[h][0].call(j.exports,function(a){var b=c[h][1][a];return f(b?b:a)},j,j.exports,a,c,d,e)}return d[h].exports}for(var g="function"==typeof b&&b,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b){b.exports=function(){function a(){this._events={}}return a.prototype.on=function(a,b){return this._events instanceof Object||(this._events={}),this._events[a]instanceof Array||(this._events[a]=[]),this._events[a].push(b),this},a.prototype.off=function(a,b){if(this._events instanceof Object||(this._events={}),!(this._events[a]instanceof Array))return!1;var c=this._events[a];return c.splice(c.indexOf(b),1),this},a.prototype.emit=function(a){if(this._events instanceof Object||(this._events={}),!(this._events[a]instanceof Array))return!1;var b=[].slice.apply(arguments,[1]);this._events[a].forEach(function(a){a instanceof Function&&a.apply(null,b)})},a}()},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[4])(4)});