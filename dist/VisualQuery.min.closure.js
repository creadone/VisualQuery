!function(p){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=p();else if("function"==typeof define&&define.amd)define([],p);else{var g;"undefined"!=typeof window?g=window:"undefined"!=typeof global?g=global:"undefined"!=typeof self&&(g=self);g.VisualQuery=p()}}(function(){return function g(k,l,d){function a(f,e){if(!l[f]){if(!k[f]){var b="function"==typeof require&&require;if(!e&&b)return b(f,!0);if(c)return c(f,!0);b=Error("Cannot find module '"+f+"'");throw b.code="MODULE_NOT_FOUND",
b;}b=l[f]={exports:{}};k[f][0].call(b.exports,function(t){var b=k[f][1][t];return a(b?b:t)},b,b.exports,g,k,l,d)}return l[f].exports}for(var c="function"==typeof require&&require,b=0;b<d.length;b++)a(d[b]);return a}({1:[function(g,k,l){k.exports=function(){function d(f,b){a.apply(this);this.name=f;this.$=c("input",{type:"text",spellcheck:"false",autoComplete:"off","class":f}).css("width","1px");b&&(this.$._.value=b);this.bindEvents()}var a=g("EventEmitter"),c=g("Element"),b=g("./inputResize");d.prototype=
Object.create(a.prototype);d.prototype.toJSON=function(){return this.$._.value};d.prototype.previewValue=function(a){this.$.attr("placeholder",a).trigger("input")};d.prototype.focus=function(a){"number"!==this.$._.type&&"number"===typeof a&&this.$._.setSelectionRange&&this.$._.setSelectionRange(a,a);this.$._.focus()};d.prototype.changeValue=function(a){a&&(this.$._.value=a);this.$.trigger("input").trigger("blur").trigger("change");this.emit("nextInput")};d.prototype.bindEvents=function(){var a=this;
this.on("rendered",function(){a.$.trigger("input")});this.$.on("focus",function(){a.emit("focus")}).on("blur",function(){a.emit("blur")}).on("change",function(){a.emit("change")}).on("keydown",function(b){0===this.selectionStart&&0===this.selectionEnd&&(37===b.keyCode||0===this.value.length&&8===b.keyCode)&&(b.preventDefault(),a.emit("prevInput"));this.value.length===this.selectionStart&&this.value.length===this.selectionEnd&&39===b.keyCode&&(b.preventDefault(),a.emit("nextInput"))}).on("input",b)};
d.prototype.validate=function(){return 0===this.$.value.length?!1:!0};return d}()},{"./inputResize":6,Element:7,EventEmitter:8}],2:[function(g,k,l){k.exports=function(){function d(a,c){f.apply(this);this.collection=a;c=c||{};this.name=new q("name",c.name);this.operator=new q("operator",c.operator);this.value=new q("value",c.value);var d=b("span",{"class":"remove",html:"&times;"}).on("click",this.emit.bind(this,"remove"));this.$=b("div",{"class":"parameter"}).append(d,this.name.$,this.operator.$,this.value.$);
this.bindEvents()}function a(a){return function(b){a.previewValue(b)}}function c(a){return function(b){a.changeValue(b)}}var b=g("Element"),f=g("EventEmitter"),e=g("./autoComplete"),q=g("./Input");d.prototype=Object.create(f.prototype);d.prototype.toJSON=function(){return{name:this.name.toJSON(),operator:this.operator.toJSON(),value:this.value.toJSON()}};d.prototype.bindEvents=function(){var a=this;this.on("rendered",function(){a.name.emit("rendered");a.operator.emit("rendered");a.value.emit("rendered")});
[this.name,this.operator,this.value].forEach(function(b){b.on("focus",function(){a.emit("focus");a.$.removeClass("error").addClass("selected")}).on("blur",function(){a.emit("blur");a.$.removeClass("selected");a.validateInputs()}).on("change",function(){a.emit("change")})});this.bindName();this.bindOperator();this.bindValue()};d.prototype.bindName=function(){var b=this;this.name.on("nextInput",function(){b.operator.focus(0)}).on("prevInput",function(){b.emit("prevParameter")}).on("focus",function(){e(b.name.$,
{appendTo:b.collection.$,datalist:b.collection.names}).on("hover",a(b.name)).on("selected",c(b.name))}).on("blur",function(){e(b.name.$)})};d.prototype.bindOperator=function(){var b=this;this.operator.on("nextInput",function(){b.value.focus(0)}).on("prevInput",function(){b.name.focus()}).on("focus",function(){e(b.operator.$,{appendTo:b.collection.$,datalist:b.collection.opts.schema[b.name.$._.value].operators}).on("hover",a(b.operator)).on("selected",c(b.operator))}).on("blur",function(){e(b.operator.$)})};
d.prototype.bindValue=function(){var b=this;this.value.on("nextInput",function(){b.emit("nextParameter")}).on("prevInput",function(){b.operator.focus()}).on("focus",function(){if("text"===b.value.$._.type)e(b.value.$,{appendTo:b.collection.$,datalist:b.collection.opts.schema[b.name.$._.value].values}).on("hover",a(b.value)).on("selected",c(b.value))}).on("blur",function(){e(b.value.$)})};d.prototype.validateInputs=function(){var a=this.name.$._.value,b=this.operator.$._.value,c=this.value.$._.value;
return(a+b+c).length?a.length&&b.length&&c.length?!0:(this.$.addClass("error"),!1):(this.emit("remove"),!1)};return d}()},{"./Input":1,"./autoComplete":5,Element:7,EventEmitter:8}],3:[function(g,k,l){k.exports=function(){function d(a){a.on("focus",function(){e.$.addClass("selected")}).on("blur",function(){e.$.removeClass("selected")}).on("remove",function(){e.remove(a)}).on("change",function(){e.callback()}).on("prevParameter",function(b){(b=e.getPrev(a))&&b.value.focus()}).on("nextParameter",function(b){(b=
e.getNext(a))?b.name.focus(0):e.insertAt(e.parameters.length,new c(e),!0)})}var a=g("Element"),c=g("./Parameter"),b=a("div",{"class":"placeholder"});b._.style.pointerEvents="none";var f=a("div",{"class":"parameters"}).append(b).on("mousedown",function(a){if(a.target===e.$._){a.preventDefault();var b=0;e.parameters.some(function(c,d){var e=c.$._.getBoundingClientRect(),f=document.body.scrollTop+e.top;if(a.pageY<e.top||f<a.pageY&&a.pageY<f+e.height&&e.left>a.pageX)return!0;b=d+1});e.insertAt(b,new c(e),
!0)}}),e={parameters:[]};e.$=f;e.init=function(a){this.opts=a;console.log(this.opts);b.text(a.placeholder||"");this.names=Object.keys(a.schema);this.opts.defaultQuery.forEach(function(a,b){e.insertAt(b,new c(e,a))});e.callback()};e.insertAt=function(a,c,e){b.hide();this.parameters[a]?f._.insertBefore(c.$._,this.parameters[a].$._):this.$.append(c.$);this.parameters.splice(a,0,c);d(c);e&&c.name.focus()};e.removeAt=function(a){a=this.parameters.splice(a,1);1===a.length&&a[0].$.remove();0===this.parameters.length&&
b.show();e.callback()};e.remove=function(a,b){if(-1===(b=this.parameters.indexOf(a)))return!1;this.removeAt(b)};e.getPrev=function(a,b){if(-1!==(b=this.parameters.indexOf(a)))return this.parameters[b-1]};e.getNext=function(a,b){if(-1!==(b=this.parameters.indexOf(a)))return this.parameters[b+1]};e.renderTo=function(b){a(b).append(this.$);this.parameters.forEach(function(a){a.emit("rendered")})};e.callback=function(){e.opts.callback(e.parameters.map(function(a){return a.toJSON()}))};return e}()},{"./Parameter":2,
Element:7}],4:[function(g,k,l){k.exports=function(d,a){var c;if("string"===typeof d)c=document.querySelector(d);else if("object"===typeof HTMLElement&&d instanceof HTMLElement||d instanceof Object&&1===d.nodeType&&"string"===d.nodeName)c=d;if(!c)throw Error("No element is selected");var b=g("./Parameters"),f=Object.create({strict:!1,schema:[],defaultQuery:[],placeholder:"",callback:function(){}}),e;for(e in a)f[e]=a[e];b.init(f);b.renderTo(c)}},{"./Parameters":3}],5:[function(g,k,l){k.exports=function(){var d=
g("EventEmitter"),a=g("Element"),c=a("ul",{"class":"autoComplete"}).css("position","absolute").hide(),b=function(){function b(c){h&&h.removeClass("selected");h=a(c).addClass("selected");m.emit("hover",h._.innerText)}function e(){for(var a=0,b=0;b<n.length;b++)n[b]._.innerText.match(new RegExp(this.value,"i"))?n[b].show():(n[b].hide(),a++);a===n.length?c.hide():c.show()}function g(a){if(38===a.keyCode){var c;h&&h.shown()&&(c=h.prev())&&c.shown()&&(a.preventDefault(),b(c))}if(40===a.keyCode)if(h&&h.shown()){var e;
(e=h.next())&&e.shown()&&(a.preventDefault(),b(e))}else for(c=0;c<n.length;c++)if(n[c].shown()){a.preventDefault();b(n[c]);break}13===a.keyCode&&(h&&h.shown()?m.emit("selected",h.text(),h.attr("value")):m.emit("selected"))}function k(c,e){var d=a("li",{text:c}).on("mouseover",function(){b(this)}).on("mousedown",function(a){a.preventDefault()}).on("mouseup",function(){h&&h.shown()&&m.emit("selected",h.text(),h.attr("value"))});e&&d.attr("value",e);return d}var l=null,m=null,n=[],h=null;return{setDatalist:function(a){n.splice(0);
for(var b in a)n.push(k(a[b],!(a instanceof Array)&&b));c.html("").append(n);return this},listenTo:function(a){l&&(h=null,l.off("keydown",g).off("input",e));l=a;m=new d;l.on("keydown",g).on("input",e);e.apply(l._);return m}}}();return function(a,e){if("INPUT"!==a._.tagName||"text"!==a.attr("type"))return Error("Autocomplete must be bound to an input-text element");if(!(e instanceof Object))return c.hide();if(!e.appendTo)return Error("The appendTo property is required to render the auto complete");
e.appendTo.append(c);c.show().offset(a._.offsetTop+a._.offsetHeight+"px",a._.offsetLeft+"px");return b.setDatalist(e.datalist).listenTo(a)}}()},{Element:7,EventEmitter:8}],6:[function(g,k,l){k.exports=function(){var d=this.value||this.attributes.placeholder&&this.attributes.placeholder.value||"",a=document.createElement("span");a.textContent=d;a.style.position="absolute";a.style.width="auto";a.style.visibility="hidden";a.style.whiteSpace="pre";var c=getComputedStyle(this);"fontSize fontFamily fontWeight fontStyle fontVariant wordSpacing letterSpacing textIndent textRendering textTransform".split(" ").forEach(function(b){a.style[b]=
c[b]});this.parentNode.appendChild(a);this.style.width=(a.offsetWidth||5)+1+"px";this.parentNode.removeChild(a)}},{}],7:[function(g,k,l){k.exports=function(){function d(a){this._=a}d.prototype.addClass=function(a){a=a.split(" ");for(var c=0;c<a.length;c++)a[c]&&(this._.classList?this._.classList.add(a[c]):this._.className=a[c]);return this};d.prototype.removeClass=function(a){this._.classList?this._.classList.remove(a):this._.className=this._.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+
"(\\b|$)","gi")," ");return this};d.prototype.hide=function(){"none"!==this._.style.display&&(this._.style.display="none");return this};d.prototype.show=function(){"block"!==this._.style.display&&(this._.style.display="block");return this};d.prototype.shown=function(){return"none"!==this._.style.display};d.prototype.on=function(a,c,b){b=!!b;a=a.split(" ");for(var d=0,e=a.length;d<e;d++)this._.addEventListener(a[d],c,b);return this};d.prototype.off=function(a,c){a=a.split(" ");for(var b=0,d=a.length;b<
d;b++)this._.removeEventListener(a[b],c);return this};d.prototype.one=function(a,c){var b=this;return this.on(a,function e(){b.off(a,e);c.apply(this,[].slice.apply(arguments))})};d.prototype.append=function(a){for(var c=a instanceof Array?a:arguments,b=0,f=c.length;b<f;b++)this._.appendChild(c[b]instanceof d?c[b]._:c[b]);return this};d.prototype.replaceWith=function(a){a=a instanceof d?a._:a;this._.parentNode&&this._.parentNode.replaceChild(a,this._);this._=a;return this};d.prototype.text=function(a,
c){var b=this.textWrap||this._;if(0===arguments.length)return b.textContent;b.textContent=(c?b.textContent:"")+a;return this};d.prototype.html=function(a,c){this._.innerHTML=(c?this._.innerHTML:"")+a;return this};d.prototype.attr=function(a,c){if("string"!==typeof a)throw Error("An attribute name is required");if("string"!==typeof c)return this._.getAttribute(a);this._.setAttribute(a,c);return this};d.prototype.remove=function(){if(this._.parentNode)return this._.parentNode.removeChild(this._),this};
d.prototype.offset=function(a,c){this._.style.top=a;this._.style.left=c;return this};d.prototype.css=function(a,c){if("string"===typeof a)if("string"===typeof c)this._.style[a]=c;else return getComputedStyle(this._)[a];else if(a instanceof Object)for(var b in a)this._.style[b]=a[b];return this};d.prototype.trigger=function(a){a=new Event(a);this._.dispatchEvent(a);return this};d.prototype.prev=function(){if(this._.previousSibling)return new d(this._.previousSibling)};d.prototype.next=function(){if(this._.nextSibling)return new d(this._.nextSibling)};
return function(a,c){if(a instanceof d)return a;var b=new d;if("string"===typeof a){if(b._=document.createElement(a),"object"===typeof c){var f=Object.create(c);"string"===typeof f.textWrap&&(b.textWrap=document.createElement(f.textWrap),b._.appendChild(b.textWrap),f.textWrap=null);void 0!==f.text&&null!==c.text&&(b.text(f.text),f.text=null);"string"===typeof f.html&&(b.html(f.html),f.html=null);"string"===typeof f.class&&(b.addClass(f.class),f.class=null);for(var e in f)f[e]&&b._.setAttribute(e,
f[e])}}else b._=a;return b}}()},{}],8:[function(g,k,l){(function(d){(function(a){if("object"===typeof l&&"undefined"!==typeof k)k.a=a();else{var c;"undefined"!==typeof window?c=window:"undefined"!==typeof d?c=d:"undefined"!==typeof self?c=self:c=this;c.b=a()}})(function(){return function c(b,d,e){function k(m,n){if(!d[m]){if(!b[m]){var h="function"==typeof g&&g;if(!n&&h)return h(m,!0);if(l)return l(m,!0);h=Error("Cannot find module '"+m+"'");throw h.code="MODULE_NOT_FOUND",h;}h=d[m]={a:{}};b[m][0].call(h.a,
function(c){var d=b[m][1][c];return k(d?d:c)},h,h.a,c,b,d,e)}return d[m].a}for(var l="function"==typeof g&&g,r=0;r<e.length;r++)k(e[r]);return k}({1:[function(c,b){b.a=function(){return function(){}}()},{}]},{},[1])(1)})}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}]},{},[4])(4)});
